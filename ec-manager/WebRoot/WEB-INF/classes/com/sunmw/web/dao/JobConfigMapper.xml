<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sunmw.web.dao.JobConfigMapper" >
  <resultMap id="BaseResultMap" type="java.util.Map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="Task_id" property="taskId" jdbcType="BIGINT" />
    <result column="IF_id" property="ifId" jdbcType="BIGINT" />
    <result column="Start_date" property="startDate" jdbcType="TIMESTAMP" />
    <result column="End_date" property="endDate" jdbcType="TIMESTAMP" />
    <result column="Last_start_time" property="lastStartTime" jdbcType="TIMESTAMP" />
    <result column="Last_end_time" property="lastEndTime" jdbcType="TIMESTAMP" />
    <result column="Is_last_success" property="isLastSuccess" jdbcType="CHAR" />
    <result column="task_status" property="taskStatus" jdbcType="INTEGER" />
    <result column="store_id" property="storeId" jdbcType="INTEGER" />
    <result column="Last_exec_time" property="lastExecTime" jdbcType="TIMESTAMP" />
    <result column="cron_expression" property="cronExpression" jdbcType="VARCHAR" />
    <result column="is_load" property="isLoad" jdbcType="VARCHAR" />
    <result column="IF_code" property="ifCode" jdbcType="VARCHAR" />
    <result column="IF_name" property="ifName" jdbcType="VARCHAR" />
    <result column="if_status" property="ifStatus" jdbcType="INTEGER" />
    <result column="Error_retry_times" property="errorRetryTimes" jdbcType="INTEGER" />
    <result column="Retry_wait_seconds" property="retryWaitSeconds" jdbcType="INTEGER" />
    <result column="Run_method" property="runMethod" jdbcType="VARCHAR" />
    <result column="Class_name" property="className" jdbcType="VARCHAR" />
    <result column="If_type" property="ifType" jdbcType="VARCHAR" />
    <result column="Class_type" property="classType" jdbcType="VARCHAR" />
    <collection property="ifPropList" javaType="java.util.List" ofType="java.util.Map">
	    <id column="If_define_prop_id" property="ifDefinePropId" jdbcType="BIGINT" />
	    <result column="Prop_name" property="propName" jdbcType="VARCHAR" />
    	<result column="Prop_value" property="propValue" jdbcType="VARCHAR" />
	    <result column="Prop_order" property="propOrder" jdbcType="INTEGER" />
	    <result column="Remark" property="remark" jdbcType="VARCHAR" />
	    <result column="Status" property="status" jdbcType="SMALLINT" />
	</collection>
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    t.Task_id, t.Start_date, t.End_date, t.Last_start_time, t.Last_end_time, t.Is_last_success, 
     t.Status task_status, t.store_id, t.Next_exec_time,  t.Last_exec_time, t.cron_expression, t.is_load,
     i.IF_id, i.IF_code, i.IF_name, i.Status if_status, i.Error_retry_times, i.Retry_wait_seconds, i.Run_method, 
    i.Class_name, i.If_type, i.Class_type,
    ip.If_define_prop_id, ip.Prop_name, ip.Prop_value, ip.Prop_order, ip.Remark, ip.Status
  </sql>
  <select id="selectNoLoadTask" resultMap="BaseResultMap" parameterType="java.util.Map" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select
    <if test="distinct" >
      distinct
    </if>
    <include refid="Base_Column_List" />
    from task_define t inner join if_define i on t.if_id = i.if_id left join if_define_prop ip on i.if_id = ip.if_id 
    where i.status=1 and t.status=1 
    <if test="IsLoad != null" >
      and t.is_load = '${IsLoad}'
    </if>
    <if test="TaskId != null" >
      and t.Task_id = ${TaskId}
    </if>
  </select>
</mapper>